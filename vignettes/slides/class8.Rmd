---
title: "Geospatial Analysis with R"
author: "Lyndon Estes & Zhiwen Zhu"
date: "9/25/2017"
output:
  slidy_presentation: 
    default:
    css: custom.css
    fig_height: 4
    fig_width: 6
subtitle: Class 8
---

## Today

- Extra catch-up lab sessions
- Step through some common issues I have noticed
- Review Assignment 2
- Control structures and plotting

## Common issues (git/GitHub)

- git/GitHub
    - Repos outside of R package directory (`xyza1`)
    - Branching--only done with git, not with new directories


```{r}
# correct
set.seed(1)
a <- sample(1:10, size = 10, replace = TRUE)

# incorrect
a <- set.seed(1); sample(1:10, size = 10, replace = TRUE)

# works but poor style
set.seed(1); a <- sample(1:10, size = 10, replace = TRUE)

```

## Assignment 1

Head over to [agroimpacts/lde1a](https://github.com/agroimpacts/lde1a)


## Control structures

- from in-class last week
    - read in `farmer_test.csv` into object `farmers`
    - use `head` and `str` to inspect the data and its types
    - use the `apply` function to take column sums and means for 3 columns
    - subset farmers using the first unique date, and by string matching values from "uuid" that contain characters "99f9"

```{r}
# Read in (converting factors to strings)
farmers <- read.csv("~/Desktop/farmer_test.csv", stringsAsFactors = FALSE)
# Note that windows doesn't use ~ in the file path, so use
# "C:/path/to/your/farmer_test.csv" type notation.

# Use head to inspect the data
head(farmers)

# Use str to look at the data types
str(farmers)

# use apply to sum the columns "pl", "ra", "mm"
apply(farmers[, c("pl", "ra", "mm")], 2, sum)
apply(farmers[, c("pl", "ra", "mm")], 2, mean)

# unique dates vector
dates <- unique(farmers$date)
dates

# subsetting
farmers2 <- farmers[farmers$date == dates[1], ]
farmers3 <- farmers[grep("99f9", farmers$uuid), ]
```

- the rest of the in-class assignment
    - calculate column sums for each date, in `for` loop
    - calculate column sums for each date, in `lapply`
    - calculate column sums for each date, in `sapply`

```{r, results='hide'}
# summing by subsets
for(i in dates) {  # i <- dates[6]
  dat <- farmers[farmers$date == i, c("pl", "ra", "mm")]
  print(apply(dat, 2, sum))
}

# skeleton of for loop
for(i in dates) {
  print(i)
}

# lapply
lres <- lapply(dates, function(x) {  # x <- dates[6]
  dat <- farmers[farmers$date == x, c("pl", "ra", "mm")]
  # apply(dat, 2, sum)
  colSums(dat)
})

# skeleton of lapply
lres <- lapply(dates, function(x) {
  x
})


sres <- sapply(dates, function(x) {
  dat <- farmers[farmers$date == x, c("pl", "ra", "mm")]
  # apply(dat, 2, sum)
  colSums(dat)
})
sres <- data.frame(t(sres))
```

## Class exercise for Wednesday

There are two. 

1. Use `lapply` and `sapply` to calculate the `colSum` (columns "pl", "ra", "mm") for observations where "uuid" contains the values "8424", "166f", "99f9". This means you will have to use the grep approach to subsetting, rather than `farmers[farmers$date == x, c("pl", "ra", "mm")]`

2. Use `write.csv` to write out the outputs of the `sapply` version of this, where you have the results for "pl", "ra", "mm" as columns, and the partial strings as rows. That means you apply `t` to the resulting object that you direct `sapply` to. I haven't shown you `write.csv` yet, so try and figure this out by adapting examples from the help file for this function (`?write.csv`)

##Plotting

```{r}
# plotting
plot(as.Date(rownames(sres)), sres$ra)

```

