---
title: "Geospatial Analysis with R"
subtitle: Class 4
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "lucy", "middlebury-fonts", "themes/class3plus.css"]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r, out.width = "80%", echo=FALSE, fig.align='center'}
knitr::include_graphics("figures/weekly-rf.png")
```

---

```{r, eval = FALSE}
data("chirps")
library(rasterVis)
library(lubridate)
zam <- getData("GADM", country = "ZMB", level = 1)

dates <- seq(as_date("2016-10-25"), as_date("2016-11-21"), by = "day")
dates <- data.frame(dates, w = unlist(lapply(1:4, function(x) rep(x, 7))))
rfweek <- stack(lapply(unique(dates$w), function(x) {
  w <- which(dates$w == x)
  calc(chirps[[x]], sum)
}))
wk <- as_date(sapply(unique(dates$w), function(x) dates[dates$w == x, 1][1]))
names(rfweek) <- wk

mapTheme <- rasterTheme(region = brewer.pal(9, "Blues"))
pstrip <- list(cex = 1, col = "white")
png("inst/slides/figures/weekly-rf.png", height = 5, width = 5, res = 300,
    units = "in", bg = "transparent")
p <- levelplot(rfweek, scales=list(draw = FALSE), par.settings = mapTheme,
               names.attr = paste("Week of", wk), axes = FALSE, xlab = "",
               ylab = "", par.strip.text = pstrip, 
               main = list("Weekly Rainfall (mm)", col = "White"), 
               colorkey = list(axis.line = list(col = "white"), 
                               axis.text = list(col = "white")))
p2 <- p + layer(sp.polygons(zam, col = "grey80", lwd = 0.7))
p2
dev.off()
```

---

## We have learned

- Overview of R.
- Fundamentals of R.
- Functions and packages.
- Environment and scoping.
- Reproducibility.

Any questions?

---

## R programming
### Indexing

- Vectors

  * A vector of positive number(s), e.g. `x[c(1, 3, 5)]`
  * A vector of negative number(s), e.g. `x[-c(1:2)]`
  * A vector of names, e.g. `x[c('name1', 'name3')]`
  * A vector of logical, e.g. `x[c(F, T, T, F)]`. But be careful of the length.
  * Nothing, e.g. `x[]`. Got a full vector
  * Zero, e.g. `x[0]`. Got a vector with length 0

Be careful of the length of the index vector!!

---

## R programming
### Indexing

- Array/Matrix

  * Each dimension is the same as vector indexing.
  * Matrix `m[row, col]`, the thing before comma is row, and the thing after comma is the col.
  * Array `a[row, col, higher-dim]`.
  * E.g. `m[1:3, ]` or `a[c(1, 3, 4), , c(T, F, F, T)]`.
  
- List

  * If we take each item within a list as a list, all vector indexing could work on list. E.g. `l[1]`, `l[1:3]`, `l[c(T, F, T)]`, `l[c('name1', 'name3')]`.
  * But every time we will still get a **list** return.
  * In order to get a simple vector, we could use `[[]]` or `$`. E.g. `l[[1]]` or `l[1][[1]]`, `l[['id']]`, `l$id`.
  * `[[]]` only can get one item as a vector each time.

---

## R programming
### Data.frame

As we said before, data.frame is a list as well, but it is designed for tabular data by mimicking some behavior of matrix:

* Methods and attributes of list also works on data.frame. E.g. `data.frame(col1 = 1:10, col2 = 2:11)` is to create a data.frame.
* Each item of the list can be treated as a column, and the length of each item of the list is row numbers. So for data.frame, each column must have same length. 
* Comparing to list, data.frame has some special attributes `row.names` to store the names of rows. `names` is still can be used to store names of column. `nrow` and `ncol` to get the number of rows and columns. `dim` function works for data.frame to get the dimensions (An evidence that data.frame mimic some behavior of matrix).

---

